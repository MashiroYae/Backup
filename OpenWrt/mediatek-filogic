#!/usr/bin/env bash

Target=mediatek
Arch=filogic

cd /srv/http/OpenWrt/ImageBuilder || exit
rm -rf openwrt-imagebuilder-$Target-$Arch.Linux-x86_64
curl -JLO https://downloads.openwrt.org/snapshots/targets/$Target/$Arch/openwrt-imagebuilder-$Target-$Arch.Linux-x86_64.tar.zst
tar --use-compress-program=unzstd -xf openwrt-imagebuilder-$Target-$Arch.Linux-x86_64.tar.zst
rm openwrt-imagebuilder-$Target-$Arch.Linux-x86_64.tar.zst
cd openwrt-imagebuilder-$Target-$Arch.Linux-x86_64 || exit

ln -s ../bin .

make -j$(nproc) image PROFILE=bananapi_bpi-r3 PACKAGES="avahi-daemon-service-http avahi-daemon-service-ssh avahi-dbus-daemon blockd bsdtar btrfs-progs cfdisk collectd-mod-sensors coreutils-cat coreutils-dd coreutils-ls dmesg dnsmasq-full dosfstools ethtool-full fdisk grep htop ip-full iw-full kmod-fs-msdos kmod-nvme kmod-usb-net-cdc-subset kmod-usb-storage-extras kmod-usb-storage-uas libgd-full lsblk lsd luci-app-irqbalance luci-app-opkg luci-app-statistics luci-app-vnstat2 luci-ssl-openssl nano-full nvme-cli openssh-sftp-avahi-service owut pciutils rsync usbutils wpad-openssl zstd -dnsmasq -libustream-mbedtls -odhcp6c -odhcpd-ipv6only -opkg -ppp -ppp-mod-pppoe -uclient-fetch -wpad-basic-mbedtls" ROOTFS_PARTSIZE="2048"
make -j$(nproc) image PROFILE=bananapi_bpi-r3-mini PACKAGES="avahi-daemon-service-http avahi-daemon-service-ssh avahi-dbus-daemon blockd bsdtar btrfs-progs cfdisk collectd-mod-sensors coreutils-cat coreutils-dd coreutils-ls dmesg dnsmasq-full dosfstools fdisk grep htop ip-full iw-full kmod-fs-msdos kmod-mtd-rw kmod-nvme kmod-usb-net-cdc-subset kmod-usb-storage-extras kmod-usb-storage-uas libgd-full lsblk lsd luci-app-irqbalance luci-app-opkg luci-app-statistics luci-app-vnstat2 luci-ssl-openssl nano-full nvme-cli openssh-sftp-avahi-service owut pciutils rsync usbutils wpad-openssl zstd -dnsmasq -libustream-mbedtls -odhcp6c -odhcpd-ipv6only -opkg -ppp -ppp-mod-pppoe -uclient-fetch -wpad-basic-mbedtls" ROOTFS_PARTSIZE="2048"
make -j$(nproc) image PROFILE=bananapi_bpi-r4 PACKAGES="avahi-daemon-service-http avahi-daemon-service-ssh avahi-dbus-daemon blockd bsdtar btrfs-progs cfdisk collectd-mod-sensors coreutils-cat coreutils-date coreutils-dd coreutils-ls dmesg dnsmasq-full dosfstools ethtool-full fdisk grep htop hwclock ip-full iw-full kmod-fs-msdos kmod-nvme kmod-usb-net-cdc-subset kmod-usb-storage-extras kmod-usb-storage-uas lm-sensors lsblk lsd luci-app-irqbalance luci-app-opkg luci-app-statistics luci-app-vnstat2 luci-proto-modemmanager luci-proto-qmi luci-ssl-openssl nano-full nvme-cli openssh-sftp-avahi-service owut pciutils rsync usbutils wpad-openssl zstd -dnsmasq -libustream-mbedtls -odhcp6c -odhcpd-ipv6only -opkg -ppp -ppp-mod-pppoe -uclient-fetch -wpad-basic-mbedtls" ROOTFS_PARTSIZE="2048"
make -j$(nproc) image PROFILE=glinet_gl-mt6000 PACKAGES="avahi-daemon-service-http avahi-daemon-service-ssh avahi-dbus-daemon blockd bsdtar btrfs-progs cfdisk collectd-mod-sensors coreutils-cat coreutils-dd coreutils-ls dmesg dnsmasq-full dosfstools fdisk grep htop ip-full iw-full kmod-fs-msdos kmod-usb-net-cdc-subset kmod-usb-storage-extras kmod-usb-storage-uas lm-sensors lsblk lsd luci-app-irqbalance luci-app-opkg luci-app-statistics luci-app-vnstat2 luci-ssl-openssl nano-full openssh-sftp-avahi-service owut rsync usbutils wpad-openssl zstd -dnsmasq -libustream-mbedtls -odhcp6c -odhcpd-ipv6only -opkg -ppp -ppp-mod-pppoe -uclient-fetch -wpad-basic-mbedtls"
make -j$(nproc) image PROFILE=openembed_som7981 PACKAGES="avahi-daemon-service-http avahi-daemon-service-ssh avahi-dbus-daemon blockd bsdtar btrfs-progs cfdisk coreutils-cat coreutils-dd coreutils-ls dmesg dnsmasq-full dosfstools ethtool-full fdisk grep htop ip-full iw-full kmod-fs-msdos kmod-nvme kmod-usb-net-cdc-subset kmod-usb-storage-extras kmod-usb-storage-uas lm-sensors lsblk lsd luci-app-irqbalance luci-app-opkg luci-ssl-openssl nano-full nvme-cli openssh-sftp-avahi-service owut pciutils rsync usbutils wpad-openssl zstd -dnsmasq -libustream-mbedtls -odhcp6c -odhcpd-ipv6only -opkg -ppp -ppp-mod-pppoe -uclient-fetch -wpad-basic-mbedtls"
make -j$(nproc) image PROFILE=openwrt_one PACKAGES="avahi-daemon-service-http avahi-daemon-service-ssh avahi-dbus-daemon blockd bsdtar btrfs-progs cfdisk coreutils-cat coreutils-dd coreutils-ls dmesg dnsmasq-full dosfstools ethtool-full fdisk grep htop ip-full iw-full kmod-fs-msdos kmod-nvme kmod-usb-net-cdc-subset kmod-usb-storage-extras kmod-usb-storage-uas lm-sensors lsblk lsd luci-app-irqbalance luci-app-opkg luci-ssl-openssl nano-full nvme-cli openssh-sftp-avahi-service owut pciutils rsync usbutils wpad-openssl zstd -dnsmasq -libustream-mbedtls -odhcp6c -odhcpd-ipv6only -opkg -ppp -ppp-mod-pppoe -uclient-fetch -wpad-basic-mbedtls"
make -j$(nproc) image PROFILE=xiaomi_mi-router-ax3000t-ubootmod PACKAGES="avahi-daemon-service-http avahi-daemon-service-ssh avahi-dbus-daemon blockd coreutils-cat coreutils-ls dmesg dnsmasq-full grep htop ip-full iw-full kmod-mtd-rw lm-sensors lsd luci-app-irqbalance luci-app-opkg luci-ssl-openssl nano-full openssh-sftp-avahi-service owut wpad-openssl -dnsmasq -libustream-mbedtls -odhcp6c -odhcpd-ipv6only -opkg -ppp -ppp-mod-pppoe -uclient-fetch -wpad-basic-mbedtls"
make -j$(nproc) image PROFILE=xiaomi_redmi-router-ax6000-ubootmod PACKAGES="avahi-daemon-service-http avahi-daemon-service-ssh avahi-dbus-daemon blockd coreutils-cat coreutils-ls dmesg dnsmasq-full grep htop ip-full iw-full kmod-mtd-rw lm-sensors lsd luci-app-irqbalance luci-app-opkg luci-ssl-openssl nano-full openssh-sftp-avahi-service owut wpad-openssl -dnsmasq -libustream-mbedtls -odhcpd-ipv6only -opkg -ppp -ppp-mod-pppoe -uclient-fetch -wpad-basic-mbedtls"

